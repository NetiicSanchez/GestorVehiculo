<h2 mat-dialog-title>      <!-- Tipo de Combustible -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Tipo de Combustible</mat-label>
        <mat-select formControlName="idTipoCombustible" required placeholder="Seleccione el tipo de combustible">
          <mat-option *ngFor="let tipo of tiposCombustible" [value]="tipo.id">
            <div class="combustible-option">
              <mat-icon>local_gas_station</mat-icon>
              <span>{{tipo.nombre}}</span>
            </div>
          </mat-option>
        </mat-select>
        <mat-error *ngIf="formulario.get('idTipoCombustible')?.hasError('required')">
          Seleccione el tipo de combustible
        </mat-error>
      </mat-form-field>rar Nueva Carga de Combustible</h2>

<mat-dialog-content>
  <form [formGroup]="formulario" (ngSubmit)="guardar()">
    <div class="form-container">
      
      <!-- Vehículo -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Vehículo</mat-label>
        <mat-select formControlName="idVehiculo" required placeholder="Seleccione un vehículo">
          <mat-option *ngFor="let vehiculo of vehiculos" [value]="vehiculo.id">
            <div class="vehiculo-option">
              <strong>{{vehiculo.nombre || vehiculo.placa}}</strong>
              <span class="vehiculo-details">{{vehiculo.marca}} {{vehiculo.modelo}} ({{vehiculo.anio}})</span>
            </div>
          </mat-option>
        </mat-select>
        <mat-error *ngIf="formulario.get('idVehiculo')?.hasError('required')">
          Seleccione un vehículo
        </mat-error>
      </mat-form-field>

      <!-- Tipo de Combustible -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Tipo de Combustible</mat-label>
        <mat-select formControlName="idTipoCombustible" required>
          <mat-option *ngFor="let tipo of tiposCombustible" [value]="tipo.id">
            {{tipo.nombre}}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="formulario.get('idTipoCombustible')?.hasError('required')">
          Seleccione el tipo de combustible
        </mat-error>
      </mat-form-field>

      <!-- Usuario (Conductor) -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Conductor</mat-label>
        <mat-select formControlName="idUsuario">
          <mat-option value="">Sin asignar</mat-option>
          <mat-option *ngFor="let usuario of usuarios" [value]="usuario.id">
            {{usuario.nombre}} {{usuario.apellido}}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Fecha de Carga -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Fecha de Carga</mat-label>
        <input matInput 
               [matDatepicker]="picker" 
               formControlName="fechaCarga" 
               required>
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
        <mat-error *ngIf="formulario.get('fechaCarga')?.hasError('required')">
          Ingrese la fecha de carga
        </mat-error>
      </mat-form-field>

      <!-- Galones y Precio -->
      <div class="row">
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Galones Cargados</mat-label>
          <input matInput 
                 type="number" 
                 step="0.01"
                 formControlName="galones" 
                 (input)="calcularTotal()"
                 required>
          <mat-error *ngIf="formulario.get('galones')?.hasError('required')">
            Ingrese los galones
          </mat-error>
          <mat-error *ngIf="formulario.get('galones')?.hasError('min')">
            Debe ser mayor a 0
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Precio por Galón</mat-label>
          <input matInput 
                 type="number" 
                 step="0.01"
                 formControlName="precioGalon" 
                 (input)="calcularTotal()"
                 required>
          <span matPrefix>Q </span>
          <mat-error *ngIf="formulario.get('precioGalon')?.hasError('required')">
            Ingrese el precio
          </mat-error>
          <mat-error *ngIf="formulario.get('precioGalon')?.hasError('min')">
            Debe ser mayor a 0
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Total Calculado -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Total Pagado</mat-label>
        <input matInput 
               [value]="totalCalculado | currency:'GTQ':'symbol':'1.2-2'" 
               readonly>
        <mat-icon matSuffix>calculate</mat-icon>
      </mat-form-field>

      <!-- Kilometraje -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Kilometraje Actual</mat-label>
        <input matInput 
               type="number" 
               formControlName="kilometraje" 
               required>
        <span matSuffix>km</span>
        <mat-error *ngIf="formulario.get('kilometraje')?.hasError('required')">
          Ingrese el kilometraje actual
        </mat-error>
        <mat-error *ngIf="formulario.get('kilometraje')?.hasError('min')">
          Debe ser mayor a 0
        </mat-error>
      </mat-form-field>

      <!-- Número de Vale/Factura -->
    <mat-form-field appearance="outline" class="full-width">
  <mat-label>Número de Vale/Factura</mat-label> 
  <input matInput formControlName="numeroFactura" required>
  <mat-icon matSuffix>receipt</mat-icon>
  <mat-error *ngIf="formulario.get('numeroFactura')?.hasError('required')">
    Este campo es obligatorio
  </mat-error>
</mat-form-field>

      <!-- Proveedor -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Proveedor de Combustible</mat-label>
        <mat-select formControlName="proveedor" required>
          <mat-option value="DON ARTURO">DON ARTURO</mat-option>
          <mat-option value="FORMULA 1">FORMULA 1</mat-option>
          <mat-option value="SHELL">SHELL</mat-option>
          <mat-option value="TEXACO">TEXACO</mat-option>
          <mat-option value="PUMA">PUMA</mat-option>
          <mat-option value="OTRO">OTRO</mat-option>
        </mat-select>
        <mat-icon matSuffix>store</mat-icon>
      </mat-form-field>

      <div class="foto-factura-section">
        <label class="upload-label">Foto de Factura</label>
  <input #inputArchivo
         type="file"
         accept="image/*"
         (change)="onFileSelected($event)"
         style="display: none;">
  <button type="button"
    class="file-select-btn"
    (click)="inputArchivo.click()">
          <mat-icon>cloud_upload</mat-icon>
          {{ archivoSeleccionado ? archivoSeleccionado.name : 'Seleccionar Foto' }}
        </button>
        <div *ngIf="archivoSeleccionado" class="file-info">
          <small>{{ archivoSeleccionado.name }} ({{ (archivoSeleccionado.size / 1024 / 1024) | number:'1.1-1' }} MB)</small>
        </div>
        <small class="file-help">Formatos permitidos: JPG, PNG, GIF. Máximo 5MB</small>
      </div>
        
        <!-- Preview de la imagen seleccionada -
        <div *ngIf="archivoSeleccionado" class="preview-container">
          <img [src]="previewUrl" alt="Preview" class="image-preview">
          <button mat-icon-button 
                  color="warn" 
                  (click)="removerArchivo()"
                  matTooltip="Quitar imagen">
            <mat-icon>close</mat-icon>
          </button>
        </div>
      </div>
      -->

      <!-- Observaciones -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Observaciones</mat-label>
        <textarea matInput 
                  formControlName="observaciones" 
                  rows="3"
                  placeholder="Comentarios adicionales..."></textarea>
        <mat-icon matSuffix>note</mat-icon>
      </mat-form-field>

    </div>
  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button 
          type="button" 
          (click)="cancelar()"
          [disabled]="guardando">
    Cancelar
  </button>
  
  <button mat-raised-button 
          color="primary" 
          (click)="guardar()"
          [disabled]="formulario.invalid || guardando">
    <mat-icon>{{guardando ? 'hourglass_empty' : 'save'}}</mat-icon>
    {{guardando ? 'Guardando...' : 'Guardar'}}
  </button>
</mat-dialog-actions>
